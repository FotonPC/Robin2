Microsoft (R) Macro Assembler Version 6.14.8444		    02/04/17 23:24:27
letter.asm						     Page 1 - 1


				include console.inc
			      C .NOLIST
			      C .LIST
			      C 
			      C 
			      C 
			      C    includelib "\masm 6.14\lib\user32.lib"
			      C    includelib "\masm 6.14\lib\kernel32.lib"
			      C    includelib "\masm 6.14\lib\msvcrt.lib"
			      C    includelib "\masm 6.14\lib\io_proc.lib"
			      C 

				COMMENT *
				   ѕараметры процедуры - два символа (передаютс€ в одном двойном
				   слове через стек). ≈сли код первого символа больше кода второго
				   - процедура ничего не делает, иначе это диапазон символов
				   ѕроцедура вводит текст (до точки) и печатает, сколько раз в текст
				   входит каждый символ из заданного диапазона
				   ¬ процедуре используетс€ локальна€ переменна€ - дл€ хранени€
				   длины заданного диапазона и локальный массив (длина массива
				   зависит от заданных параметров)
				*

 00000000			.code
 00000000			Letter proc near
 00000000  55			   push ebp
 00000001  8B EC		   mov  ebp, esp  ; стандартные входные действи€ процедуры (пролог)
 00000003  66| 83 EC 04		   sub  sp,4   ; локальна€ переменна€ дл€ хранени€ длины диапазона
 00000007  50			   push eax   ; сохранение регистров
 00000008  53			   push ebx
 00000009  51			   push ecx
 0000000A  52			   push edx
 0000000B  57			   push edi
 0000000C  8B 55 08		   mov  edx, [ebp+8]  ; читаем параметр из стека
				   outstr '¬ыбран диапазон  '
				   outchar dl
				   outchar ":"
				   outchar dh
 0000014D  33 C9		   xor  ecx, ecx
 0000014F  8A CE		   mov  cl,dh
 00000151  2A CA		   sub  cl,dl
 00000153  0F 8C 000005B0	   jl   @kon; результат <0 - делать ничего не надо
 00000159  83 C1 01		   add  ecx,1  ; вычислена длина исследуемого диапазона
				   outintln cl,, '  длина '	
 00000259  89 4D FC		   mov  [ebp-4], ecx ; сохранили ее в локальной переменной в стеке
				   newline
 0000030E			@@:
 0000030E  6A 00		   push 0  ; запись в стек ecx нулей - счетчики дл€ символов
 00000310  E2 FC		   loop @B
 00000312  8B FC		   mov  edi, esp  ; установили edi на начало массива в стеке  
 00000314  33 DB		   xor  ebx, ebx ; регистр дл€ работы с массивом
				   outstrln '¬водите текст с точкой на конце :'
 000003FB			@@:   ;начало ввода 
				   inchar Bl  ; ввели очередной символ
 0000042F  80 FB 2E		   cmp  Bl, '.'
 00000432  74 0F		   je   @F  ; на метку "обработка содержимого стека"
 00000434  38 D3		   cmp  Bl, dl
 00000436  72 C3		   jb   @B ; меньше начала диапазона, переход на начало ввода
 00000438  38 F3		   cmp  Bl, dh
 0000043A  77 BF		   ja   @B ; больше конца диапазона, переход на начало ввода
 0000043C  2A DA		   sub  Bl, dl ; - номер буквы (начина€ с 0) 
 0000043E  FF 04 9F		   inc  dword ptr [edi+ebx*4] 
 00000441  EB B8		   jmp  @B ; на метку "начало ввода" 
 00000443			@@: ; обработка содержимого стека
 00000443  8B 4D FC		   mov  ecx, [ebp-4]  ; восстановили длину диапазона 
				   outstrln 'вот сколько раз встретилс€ каждый символ из заданного диапазона' 
 0000052B			@@:
				   outchar dl
 00000584  58			   pop  eax
				   outintln eax, 3
 0000064E  FE C2		   inc  dl
 00000650  49			   dec  ecx   ; это замена LOOP - он здесь не проходит
 00000651  0F 85 FFFFFED4	   jnz  @B 
				   newline 
 00000709			@kon:  ; выходные действи€ процедуры, эпилог
 00000709  5F			   pop  edi
 0000070A  5A			   pop  edx
 0000070B  59			   pop  ecx 
 0000070C  5B			   pop  ebx
 0000070D  58			   pop  eax
 0000070E  8B E5		   mov  esp, ebp
 00000710  5D			   pop  ebp
 00000711  C2 0004		   ret 4*1 ; удал€ем из стека параметр 
 00000714			Letter endp

 00000714			Start:
				   ClrScr
				   ConsoleTitle "  ѕроцедура с локальным массивом"
 0000074C  33 C0		   xor  eax, eax
 0000074E  B0 C1		   mov  al, 'Ѕ'
 00000750  B4 C6		   mov  ah, '∆'
 00000752  50			   push eax
 00000753  E8 FFFFF8A8		   call Letter
				   outstr 'введите еще один диапазон - два символа  '
				   inchar bl
				   inchar bh
 000007F3  53			   push ebx
				   ConsoleMode; Ќе перекодировать русские буквы
 000007FA  E8 FFFFF801		   call Letter
				   newline 
				   exit
				   end Start
